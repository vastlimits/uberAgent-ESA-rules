#
# The rules are generated from the Sigma GitHub repository at https://github.com/Neo23x0/sigma
# Follow these steps to get the latest rules from the repository with Python
#    1. Clone the repository locally
#    2. Using a commandline, change working directory to the just cloned repository
#    3. Run sigmac -I --target uberagent -r rules/
#
# The rules in this file are marked with sigma-level: low
#

[ActivityMonitoringRule platform=MacOS]
# Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system.
RuleId = 51719bf5-e4fd-4e44-8ba8-b830e7ac0731
RuleName = Creation Of A Local User Account
EventType = Process.Start
Tag = proc-start-creation-of-a-local-user-account
RiskScore = 25
Annotation = {"mitre_attack": ["T1136.001"]}
Query = (Process.Path like r"%/dscl" and Process.CommandLine like r"%create%")

[ActivityMonitoringRule platform=MacOS]
# Detects enumeration of local systeam accounts on MacOS
RuleId = ddf36b67-e872-4507-ab2e-46bda21b842c
RuleName = Local System Accounts Discovery - MacOs
EventType = Process.Start
Tag = proc-start-local-system-accounts-discovery-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1087.001"]}
Query = ((Process.Path like r"%/dscl" and Process.CommandLine like r"%list%" and Process.CommandLine like r"%/users%") or (Process.Path like r"%/dscacheutil" and Process.CommandLine like r"%-q%" and Process.CommandLine like r"%user%") or Process.CommandLine like r"%'x:0:'%" or (Process.Path like r"%/cat" and (Process.CommandLine like r"%/etc/passwd%" or Process.CommandLine like r"%/etc/sudoers%")) or Process.Path like r"%/id" or (Process.Path like r"%/lsof" and Process.CommandLine like r"%-u%"))

[ActivityMonitoringRule platform=MacOS]
# Detection use of the command "split" to split files into parts and possible transfer.
RuleId = 7f2bb9d5-6395-4de5-969c-70c11fbe6b12
RuleName = Split A File Into Pieces
EventType = Process.Start
Tag = proc-start-split-a-file-into-pieces
RiskScore = 25
Annotation = {"mitre_attack": ["T1030"]}
Query = Process.Path like r"%/split"

[ActivityMonitoringRule platform=MacOS]
# Detects attempts to use system dialog prompts to capture user credentials
RuleId = 60f1ce20-484e-41bd-85f4-ac4afec2c541
RuleName = GUI Input Capture - macOS
EventType = Process.Start
Tag = proc-start-gui-input-capture-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1056.002"]}
Query = (Process.Path == "/usr/sbin/osascript" and Process.CommandLine like r"%-e%" and Process.CommandLine like r"%display%" and Process.CommandLine like r"%dialog%" and Process.CommandLine like r"%answer%" and (Process.CommandLine like r"%admin%" or Process.CommandLine like r"%administrator%" or Process.CommandLine like r"%authenticate%" or Process.CommandLine like r"%authentication%" or Process.CommandLine like r"%credentials%" or Process.CommandLine like r"%pass%" or Process.CommandLine like r"%password%" or Process.CommandLine like r"%unlock%"))

[ActivityMonitoringRule platform=MacOS]
# Detects attempts to use screencapture to collect macOS screenshots
RuleId = 0877ed01-da46-4c49-8476-d49cdd80dfa7
RuleName = Screen Capture - macOS
EventType = Process.Start
Tag = proc-start-screen-capture-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1113"]}
Query = Process.Path == "/usr/sbin/screencapture"

[ActivityMonitoringRule platform=MacOS]
# Detects usage of base64 utility to decode arbitrary base64-encoded text
RuleId = 719c22d7-c11a-4f2c-93a6-2cfdd5412f68
RuleName = Decode Base64 Encoded Text -MacOs
EventType = Process.Start
Tag = proc-start-decode-base64-encoded-text-macos
RiskScore = 25
Annotation = {"mitre_attack": ["T1027"]}
Query = (Process.Path == "/usr/bin/base64" and Process.CommandLine like r"%-d%")

[ActivityMonitoringRule platform=MacOS]
# Detects enumeration of local or remote network services.
RuleId = 84bae5d4-b518-4ae0-b331-6d4afd34d00f
RuleName = MacOS Network Service Scanning
EventType = Process.Start
Tag = proc-start-macos-network-service-scanning
RiskScore = 25
Annotation = {"mitre_attack": ["T1046"]}
Query = (((Process.Path like r"%/nc" or Process.Path like r"%/netcat") and not (Process.CommandLine like r"%l%")) or (Process.Path like r"%/nmap" or Process.Path like r"%/telnet"))

[ActivityMonitoringRule platform=MacOS]
# Detects macOS Gatekeeper bypass via xattr utility
RuleId = f5141b6d-9f42-41c6-a7bf-2a780678b29b
RuleName = Gatekeeper Bypass via Xattr
EventType = Process.Start
Tag = proc-start-gatekeeper-bypass-via-xattr
RiskScore = 25
Annotation = {"mitre_attack": ["T1553.001"]}
Query = (Process.Path like r"%/xattr" and Process.CommandLine like r"%-r%" and Process.CommandLine like r"%com.apple.quarantine%")

